# JVM

## 1 自动内存管理

Java 虚拟机所管理的内存将会包括以下几个运行时数据区域：

![1646317447356](D:\git\Java_Resource\1646317447356.png)

### 1.1 程序计数器

​		程序计数器存在线程私有空间中，指向下一行线程所执行的行号，用于线程的流程控制，包括分支、循环、跳转、异常处理等。因为Java虚拟机在多线程处理的时候是采用分配处理器的执行时间方式来实现，在一次线程上下文切换的过程中为了保证能够正确的回到上一次执行的位置。

​		如果是JAVA方法，那么指向的是正在执行的虚拟机字节码指令的地址。如果是本地Native方法，那么程序计算器中的值应该是空(Undefined)。程序计数器是唯一一个不会出现OOM的地方。

### 1.2 虚拟机栈（栈通常是指虚拟机栈）

​		虚拟机栈同样是线程私有，生命周期与线程相同。描述的是Java方法执行的线程内存模型，

每一个方法被执行都会新建一个栈帧，用于存储局部变量、操作数栈、动态链接、方法出口信息等。方法调用完毕之后，栈帧也随即出栈。

​		局部变量在栈中，以局部变量表的形式存储，局部变量槽(Slot)进行表示。long和double占用两个变量槽，其他的占用一个变量槽。

​		栈内存溢出主要分为两种，线程请求栈深度超过虚拟机所允许的最大深度则抛出StackOverflowError。如果Java虚拟机容量可以动态扩展，但是申请不到足够的内存，那么抛出OutOfMemoryError。

### 1.3 本地方法栈

​		和虚拟机栈的唯一区别就是，本地方法栈为本地方法执行而提供服务，例如Java调用Python方法或者C方法等。

### 1.4 Java堆

​		虚拟机中最大的一块共享内存，几乎所有的对象实例都在这里分配。

​		-Xms 虚拟机启动时分配的内存大小

​		-Xmx 虚拟机最大的分配内存大小

​		-Xss 为JVM启动的每一个线程分配的内存大小